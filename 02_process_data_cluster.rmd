---
editor_options:
  chunk_output_type: console
---

```{r load_libs_res, eval=FALSE}
# data libraries
library(readr)
library(dplyr)
library(purrr)

# plotting
library(ggplot2)
library(patchwork)
```

```{r load_res, eval=FALSE}
# find data
data_files <- list.files("data", pattern = "data_global_summary",
                         recursive = TRUE, full.names = TRUE)
# read data
data <- map(data_files, read_csv)
```

```{r plot_res, eval=FALSE}
a = data[[1]] %>% 
  filter(variable !="M")
a = split(a, a$phi) %>% 
  map(function(df){split(df, df$init_d)})

a_fig = map2(a, names(a), function(df_list, name){
  title = glue::glue('Î¦ number of peaks: {name}')
  
  fig_subpanel <- map2(df_list, names(df_list), function(df, name2){
    
    subtitle = glue::glue('initial D: {name2}')
    
    fig_param <- ggplot(df, aes(x=gen, y=mean, ymin=mean-sd, ymax=mean+sd,
                   col = variable, fill = variable, group = variable))+
      #geom_pointrange(size = 0.1)+  
      geom_ribbon(alpha = 0.3, col = NA, fill = "grey")+
      geom_line(size = 0.2, alpha = 0.9)+
      
      scale_colour_brewer(palette = "Set1")+
      # scale_fill_viridis_c(option = "E", limits = c(0, 250),
      #                      na.value = "steelblue", direction = -1)+
      scale_x_continuous(breaks = c(0,50000,100000),
                         labels = as.character(c(0, 50, 100)))+
      scale_y_continuous(breaks = c(0,0.5,1),
                         labels = c(0, 0.5, 1))+
      theme_minimal(base_size = 5)+
      theme(plot.background = element_rect(colour = "black", fill=NA,
                                           size = 0.2),
            panel.border = element_rect(colour = "black", fill=NA,
                                        size = 0.2),
            panel.grid = element_blank(),
            axis.title = element_text(),
            # plot.title = element_text(face = "bold"),
            legend.position = "none",
            axis.text.y = element_text(angle = 90))+
      coord_cartesian(expand = F, ylim =c(0,1))+
      facet_grid(variable~rep,labeller = label_both)+
      labs(x = NULL, y = NULL, title = subtitle)
  })
  fig_param <- wrap_plots(fig_subpanel, guides = "collect", ncol = 3)+
    plot_annotation(title = title,
                    theme = theme(plot.title = element_text(size = 6)))
  
  return(fig_param)
  
})

cairo_pdf(file = "fig_param_trajectory.pdf", width = 10, height = 3,
          onefile = TRUE)
{
  walk(a_fig, print)
}
dev.off()
```

