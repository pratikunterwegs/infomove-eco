---
editor_options:
  chunk_output_type: console
---

# Run an Infomove variant on the cluster

In this version, the evolved parameter D (aspiration) is also allowed to evolve.

## Prepare libraries

Libs remain the same in R.

```{r load_libs_v03, eval=FALSE}
# load libs
library(readr)
library(ssh)
library(glue)

# install infomover
devtools::install_github("pratikunterwegs/infomover", upgrade = "never")
```

## Prepare infomove v03 on Peregrine

Check out the _allow_D_ branch on the cluster.

```{r prepare_infomove_v03, eval=FALSE}
# read peregrine password
password = read_lines("private/password.txt")

# connect to cluster and pull from master
s <- ssh_connect("p284074@peregrine.hpc.rug.nl", passwd = password)
ssh_exec_wait(s, command = c("cd infomove/",
                             "rm Makefile infomove",
                             "cd jobs",
                             "rm *.sh",
                             "rm *.out",
                             "cd ..",
                             "git pull",
                             "git checkout allow_D", # checkout the allow_D branch
                             "ml load GCC/8.3.0",
                             "ml load GSL/2.6-GCC-8.3.0",
                             "qmake infomove.pro",
                             "make clean -j4",
                             "make -j4"))
```

## Remove old data

```{r rem_old_data_v03, eval=FALSE}
{
  ssh_exec_wait(s, c("cd infomove/data",
  'find . -name "*.csv" -type f -delete'))
}
```

## Run infomove

Run infomove from the R package.

```{r use_infomover, eval=FALSE}
infomover::run_infomove(ssh_con = "p284074@peregrine.hpc.rug.nl",
                        password = password,
                        type = c("info", "noinfo"),
                        phi = c(5, 25, 50, 100),
                        rho = 0.1,
                        gens = "50000", # a test case
                        timesteps = 100,
                        init_d = c(0.5), # D init at 0.5
                        leader_choices = c(1,2,5),
                        rep_n = 5)
)
```


```{r close_conn_v03, eval=FALSE}
# move into jobs, delete scripts and disconnect
ssh_exec_wait(s, command = c("cd infomove/jobs",
                             "rm *.sh *.out",
                             "cd .."))
ssh_disconnect(s)
```
